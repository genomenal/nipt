---
sidebar_position: 2
sidebar_label: Шаблон отчёта
---

# Шаблон отчёта

Шаблон отчёта - это основа для представления результатов анализа образца в виде структурированного отчёта.
Редактировать шаблона отчёта может только администратор Программы.
У всех остальных пользователей отчёты строятся по шаблону, сформированному администратором.

Чтобы открыть страницу шаблона отчёта, перейдите в раздел "**Шаблон отчёта**" из блока страниц
"*Настройки*" (доступны только для администратора) через панель навигации слева:

<p align="center">
<img src={require('/img/report_templates/rt_page.png').default} width="900"/>
</p>

Вверху страницы находятся следующие поля:
- **Имя** отчёта - даёт название вкладке с отчётом на <a href="/results">странице образца</a>.
- **Активен**: если переключатель включён <img src={require('/img/rus/toggle_on.png').default} width="35"/>, то
шаблон будет активным, т.е. будет применён ко всем образцам, соответствующим условиям построения отчёта;
если переключатель выключен <img src={require('/img/rus/toggle_off.png').default} width="35"/>,
то шаблон будет неактивным, т.е. не будет применён ни к одному загружаемому образцу.
- **Заголовок отчёта** - отображается вверху страницы отчёта.
- **Описание отчёта** - отображается под заголовком на странице отчёта.

Шаблон отчёта состоит из блоков.

## Добавление блока шаблона {#add-block}

Если в шаблоне уже есть добавленные блоки, то компонент для добавления нового блока находится под всеми добавленными
блоками. Для добавления блока шаблона нажмите на окно поиска в этом компоненте и выберите из появившегося списка
нужный тип блока (подробно описаны ниже):

<p align="center">
<img src={require('/img/report_templates/add_new_block.png').default} width="900"/>
</p>

После выбора типа блока заполните все необходимые поля и
нажмите <img src={require('/img/report_templates/add_btn.png').default} width="170"/>. Для отмены выбора типа блока
нажмите <img src={require('/img/report_templates/cancel.png').default} width="150"/>.

## Типы блоков шаблона отчёта {#block-types}

### Блок "Раздел" {#section}

Блок с заголовком и описанием раздела отчёта. Поля для заполнения:
- <b>Имя</b> - заголовок раздела (обязательно для заполнения). Если в отчёте несколько разделов, то они
будут автоматически пронумерованы.
- <b>Описание</b> раздела (будет написано под заголовком раздела).

<p align="center">
<img src={require('/img/rus/section.png').default} width="900"/>
</p>

### Блок "Информация о пациенте" {#patient-info}

Блок с информацией о пациенте, в карточку которого был добавлен образец или который
был определен для образца (для образцов, загруженных в запуск). В этом блоке необходимо
выбрать (отметить галочкой) те поля с информацией о пациенте, которые будут отображаться в отчёте.
Возможные поля:
- Код пациента;
- Имя;
- Фамилия;
- Отчество;
- Дата рождения;
- Возраст;
- Комментарии;
- Срок беременности в неделях;
- Врач;
- Медицинское учреждение.

<p align="center">
<img src={require('/img/rus/patient_info_block.png').default} width="900"/>
</p>

После того, как вы выбрали все нужные поля, кликните вне области заполнения значения.
Пример блока в отчёте можно найти [здесь](/nipt-report#patient-info).

### Блок "Информация об образце" {#sample-info}

Блок с информацией об образце, для которого строится отчёт. В этом блоке необходимо
выбрать (отметить галочкой) те поля с информацией об образце, которые будут отображаться в отчёте.
Возможные поля:
- Имя образца - название файла образца без расширения;
- Дата забора крови;
- Комментарии;
- Дата анализа.

<p align="center">
<img src={require('/img/rus/sample_info_block.png').default} width="900"/>
</p>

После того, как вы выбрали все нужные поля, кликните вне области заполнения значения.
Пример блока в отчёте можно найти [здесь](/nipt-report#sample-info).

### Блок "Форматированный текст" {#formated-text}

Блок с любым текстом в формате [Markdown](https://www.markdownguide.org/basic-syntax/).
В текст можно вставить определенные автополя, их описание приведено
[ниже](/settings/report-templates/report-templates#autofields).

<p align="center">
<img src={require('/img/rus/formated_text.png').default} width="900"/>
</p>

### Блок "Дисклеймер" {#discleimer}

Блок с сообщением об ограничении использования отчёта. В текст можно вставить определенные автополя, их описание
приведено [ниже](/settings/report-templates/report-templates#autofields).

#### Автополя в блоках "Форматированный текст" и "Дисклеймер" {#autofields}

Автополе - это определенный маркер в фигурных скобках, который, если вставить его в текст блока шаблона,
будет автоматически заполняться определенным значением в готовом отчёте. Например, если вставить в текст блока
шаблона `{url}`, то в тексте отчёта на месте этого автополя появится URL-адрес текущей страницы (по сути это будет
ссылка на страницу образца). Значения в уже готовом отчёте будут меняться по мере изменения соответствующих данных о
пациенте или образце, для их обновления перезапускать генерацию отчёта не нужно.

***Список возможных автополей и их значений:***

- `{url}` - адрес текущей страницы;
- `{ReportName}` - имя отчёта (задается на странице шаблона отчёта);
- `{patient.code}` - код пациента (задается при создании пациента, может быть изменен на странице пациента);
- `{patient.firstName}` - имя пациента (задается при создании пациента или на странице пациента);
- `{patient.middleName}` - отчество пациента (задается на странице пациента);
- `{patient.lastName}` - фамилия пациента (задается при создании пациента или на странице пациента);
- `{patient.dateOfBirth}` - дата рождения пациента (задается на странице пациента);
- `{patient.age}` - возраст пациента (определяется автоматически после указания даты рождения на странице пациента);
- `{patient.comments}` - комментарии к карточке пациента (добавляются на странице пациента);
- `{sample.sampleName}` - название образца (имя файла без расширения; может быть изменено на странице образца);
- `{sample.sampleCollectionDate}` - дата забора крови (задается на странице образца);
- `{sample.comments}` - комментарии к образцу (добавляются на странице образца).

:::tip СОВЕТ
По правилам Markdown для перехода на новую строку в тексте используйте два пробела.
:::

### Блок "Место для подписи" {#sign-place}

Блок с местом для подписи врача. В отчёте это будет выглядеть следующим образом:

<p align="center">
<img src={require('/img/report_templates/signing_place.png').default} width="500"/>
</p>

### Блок "НИПТ" {#nipt}

Блок с результатом неинвазивного пренатального ДНК-скрининга образца. Поля для заполнения:
- <b>Имя</b> - заголовок блока (обязательно для заполнения).
- <b>Описание</b> блока (будет написано под заголовком блока).

Пример блока в отчёте можно найти [здесь](/nipt-report#results).

## Добавленный блок шаблона {#added-template}

Добавленный блок шаблона выглядит следующим образом (пример - блок "*Информация о пациенте*"):

<p align="center">
<img src={require('/img/report_templates/block_example.png').default} width="900"/>
</p>

Сверху написано название блока, а в основной части приведена информация о его содержании.

### Перемещение блока в шаблоне {#move-block}

Для того чтобы поднять добавленный блок в шаблоне выше предыдущего блока
нажмите на <img src={require('/img/report_templates/up.png').default} width="25"/>, а чтобы опустить ниже -
нажмите на <img src={require('/img/report_templates/down.png').default} width="25"/>.

### Редактирование блока шаблона {#edit-block}

Для того чтобы отредактировать добавленный блок
нажмите на <img src={require('/img/report_templates/edit.png').default} width="23"/>, отредактируйте, а затем
нажмите на <img src={require('/img/report_templates/add_btn.png').default} width="170"/> для сохранения изменений.
Для отмены внесенных изменений нажмите <img src={require('/img/report_templates/cancel.png').default} width="150"/>.

### Удаление блока шаблона {#delete-block}

Для того чтобы удалить добавленный блок
нажмите на <img src={require('/img/report_templates/delete.png').default} width="23"/>, а затем
на <img src={require('/img/rus/delete.png').default} width="150"/> в появившемся окне подтверждения.
Для отмены удаления нажмите <img src={require('/img/report_templates/cancel.png').default} width="150"/>
или вне окна подтверждения.

## О построении отчёта {#report-generation}

Отчёт строится для образца, если выполняются следующие условия:
1. Анализ образца успешно завершился (то есть все стадии анализа имеют статус "*Завершено*").
2. Для образца были получены необходимые для построения отчёта результаты. Если шаблон включает блок "*НИПТ*",
то для построения соответствующего отчёта необходимо успешное завершение стадии "*Выявление вариации числа копий*".
4. Шаблон отчёта активен.
5. Шаблон отчёта имеет хотя бы один добавленный блок.
6. Шаблон отчёта был добавлен раньше, чем был обработан образец.
