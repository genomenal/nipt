---
sidebar_position: 3
sidebar_label: Настройки выравнивания
---

# Настройки выравнивания

Выравнивание (картирование) данных секвенирования на референсную геномную последовательность является
фундаментальным этапом анализа NGS. Для выравнивания используется версия
[GRCh38.p14](https://www.ncbi.nlm.nih.gov/datasets/genome/GCF_000001405.40/) референсного генома человека.
По умолчанию выравнивание производится с помощью инструмента ***BWA2 Burrows-Wheeler Aligner*** (BWA-MEM2) -
новейшей и более быстрой версии алгоритма BWA-MEM, который основан на обратном поиске с преобразованием
Берроуза-Уилера (BWT) и эффективно и быстро выравнивает короткие прочтения секвенирования на геном человека,
допуская мисмэтчи и гэпы[^1]. О том, как поменять инструмент выраванивания, вы можете узнать
в [соответствующем разделе](/settings/settings/alignment-settings#change-alignment-tool).

### Отключение выравнивания {#disable-alignment}

:::info На заметку
Если выравнивание исключено из анализа, проведение неинвазивного пренатального ДНК-скрининга становится невозможным.
:::

Если вы хотите отключить выравнивание, выключите соответствующий тумблер:

<p align="center">
<img src={require('/img/rus/turn_off_alignment.png').default} width="400"/>
</p>

### Отключение проверки и восстановления парности прочтений {#disable-repair}

При анализе результатов парного секвенирования (в этом случае фрагменты ДНК секвенируют с каждого конца
навстречу друг другу) для выравнивания необходимо, чтобы каждое прочтение из одного файла содержало пару во втором,
поэтому перед выравниванием проводится проверка и восстановление парности прочтений.
Парность (количество и порядок прочтений) могут не совпадать в исходных файлах парного секвенирования.
Кроме того, парность может быть нарушена при очистке данных - тогда необходимо удалить прочтения,
которые лишились пары. Если количество прочтений в файлах не совпадает, то этапа проверки и восстановления
парности не избежать - он запустится, даже если стадия отключена. Однако, если вы уверены в качестве
своих данных и хотите ускорить процесс анализа, то вы можете отключить данный этап, выключив тумблер:

<p align="center">
<img src={require('/img/rus/turn_off_repair.png').default} width="400"/>
</p>

### Смена инструмента для выравнивания {#change-alignment-tool}

Инструментом для выравнивания по умолчанию является *BWA2 Burrows-Wheeler Aligner*.
Его можно поменять на *BWA Burrows-Wheeler Aligner* - более раннюю версию алгоритма BWA-MEM[^2].
Для этого нажмите на значение поля "*Alignment tool*" и выберите нужный выравниватель:

<p align="center">
<img src={require('/img/rus/change_alignment_tool.png').default} width="420"/>
</p>

### Выравнивание синглтонов {#use-singleton-reads}

Если прочтение в одном файле не имеет пары в парном файле, оно называется синглтоном (singleton read).
Такое может произойти, если в файлах смешаны результаты парного и одиночного
секвенирования, либо если парное прочтение было утеряно в ходе предварительной обработки данных (например, во
время очистки). Если опция "Use singleton reads" отключена, то синглтоны выбрасываются из дальнейшего анализа на
этапе проверки и восстановления парности прочтений. Если вы хотите, чтобы синглтоны тоже выравнивались на геном,
включите соответствующий тумблер:

<p align="center">
<img src={require('/img/rus/singletons.png').default} width="400"/>
</p>

### Метрики оценки качества выравнивания {#alignment-metrics}

<table>
  <tr>
   <td>Метрика</td>
   <td>Порог метрики, при котором файл выравнивания считается качественным</td>
   <td>Значение порога по умолчанию</td>
  </tr>
  <tr>
   <td>Mapped reads (картированные прочтения)</td>
   <td><b>Min mapped reads percent</b> - минимально допустимая доля количества картированных прочтений
   в файле выравнивания.</td>
   <td>85%</td>
  </tr>
  <tr>
   <td>Multiple alignments (множественные выравнивания)</td>
   <td><b>Max multimaps percent</b> - максимально допустимая доля множественных выравниваний одного и тоже прочтения
   на геном в файле выравнивания.</td>
   <td>15%</td>
  </tr>
  <tr>
   <td>Forward/reverse balance (равновесие прочтений с прямой и обратной цепи)</td>
   <td><b>Forward/reverse max difference</b> - максимально допустимая разница в количестве прочтений с прямой цепи и
   прочтений с обратной цепи в файле выравнивания.</td>
   <td>10%</td>
  </tr>
  <tr>
   <td>Paired mapped reads (картированные парные прочтения)</td>
   <td><b>Min paired mapped percent</b> - минимально допустимая доля количества картированных парных прочтений
   в файле выравнивания.</td>
   <td>80%</td>
  </tr>
  <tr>
   <td>Paired properly mapped reads (правильно картированные парные прочтения)</td>
   <td><b>Min paired properly mapped reads percent</b> - минимально допустимая доля количества правильно картированных
   парных прочтений в файле выравнивания.</td>
   <td>75%</td>
  </tr>
  <tr>
   <td>Coverage per nucleotide (понуклеотидное покрытие)</td>
   <td><b>Min coverage per nucleotide</b> - минимально допустимое понуклеотидное покрытие на геноме.</td>
   <td>0.1</td>
  </tr>
</table>

Если значение метрики в файле выравнивания образца не удовлетворяет установленному порогу,
то файл отмечается как не удовлетворяющий требованиям метрики, т.е. выравнивание завершается успешно,
а в статусе стадии указывается количество метрик, которые не соответствуют критериям.
Если же никакие прочтения образца не выровнялись на геном,
то [стадия "Выравнивание"](/workflow-details/alignment) завершается с ошибкой
и анализ останавливается.

### Изменение порогов метрик {#change-metric-thresholds}

Чтобы изменить значение порога метрики, нажмите на текущее значение и отредактируйте его.
Для сохранения изменений нажмите клавишу "Enter" или кликните левой кнопкой мыши в свободное место на странице.

[^1]: [Vasimuddin M., Sanchit M., Heng L., Srinivas A. Efficient Architecture-Aware Acceleration of BWA-MEM for Multicore Systems. IEEE Parallel and Distributed Processing Symposium (IPDPS) (2019)](https://doi.org/10.1109/IPDPS.2019.00041)
[^2]: [Li H. Aligning sequence reads, clone sequences and assembly contigs with BWA-MEM. arXiv:1303.3997v2 (2013)](https://doi.org/10.48550/arXiv.1303.3997)
