---
sidebar_position: 1
sidebar_label: Шаблоны отчётов
---

# Шаблоны отчётов

Если вы хотите, чтобы результаты анализа образца были представлены в виде структурированного отчёта с нужной вам
информацией, вы можете создать, импортировать или отредактировать шаблон нужного отчёта на странице "Шаблоны отчётов".

:::info На заметку
Количество и вид шаблонов на странице "Шаблоны отчётов" зависит от первоначальных настроек,
сделанных администратором Системы.
:::

Чтобы открыть раздел с шаблонами отчётов, перейдите на страницу "**Шаблоны отчётов**" из блока страниц
"Настройки" через панель навигации слева:

<p align="center">
<img src={require('/img/report_templates/rt_page.png').default} width="900"/>
</p>

## Добавление шаблона отчёта {#add-template}

Нажмите на <img src={require('/img/rus/add_template.png').default} width="170"/>, чтобы открыть страницу
добавления шаблона отчёта:

<p align="center">
<img src={require('/img/report_templates/add_template_page.png').default} width="900"/>
</p>

На странице можно заполнить следующие поля:
1. Имя отчёта (дает название <a href="/results/results">вкладке с отчётом</a> на странице образца). Обязательно
к заполнению.
2. Активен: если переключатель включён <img src={require('/img/rus/toggle_on.png').default} width="35"/>, то
шаблон будет активным, т.е. будет применён ко всем образцам, соответствующим условиям построения отчёта;
если переключатель выключен <img src={require('/img/rus/toggle_off.png').default} width="35"/>,
то шаблон будет неактивным, т.е. не будет применён ни к одному загружаемому образцу.
3. Заголовок отчёта.
4. Описание отчёта (отображается под заголовком на странице отчёта).

Заполните все необходимые поля и нажмите
на <img src={require('/img/report_templates/save_temaplate.png').default} width="150"/>, чтобы сохранить шаблон.
Если вы покинете страницу, нажав на <img src={require('/img/report_templates/cancel.png').default} width="150"/>, или
любым другим образом, шаблон не будет сохранён. Страница сохранённого шаблона выглядит так:

<p align="center">
<img src={require('/img/report_templates/saved_template.png').default} width="900"/>
</p>

## Редактирование шаблона отчёта {#edit-template}

Помимо описанных в предыдущем разделе полей ("Имя", "Активен", "Заголовок отчёта", "Описание отчёта")
на странице сохраненного шаблона можно отредактировать блоки шаблона.

:::note На заметку
Все изменения в шаблоне применятся к образцам, если те были загружены после внесения изменений или если
для них была перезапущена любая стадия анализа после внесения изменений.
:::

Для того чтобы шаблон был активен, в него необходимо добавить хотя бы один блок (помимо включенной опции "Активен").

### Добавление блока шаблона {#add-block}

Для добавления блока шаблона нажмите на окно поиска и выберите из появившегося списка нужный тип блока (подробно
описаны ниже):

<p align="center">
<img src={require('/img/report_templates/add_new_block.png').default} width="900"/>
</p>

После выбора типа блока заполните все необходимые поля и
нажмите <img src={require('/img/report_templates/add_btn.png').default} width="170"/>. Для отмены выбора типа блока
нажмите <img src={require('/img/report_templates/cancel.png').default} width="150"/>.

#### Типы блоков шаблона отчёта и их редактирование {#block-types}

<table>
  <tr>
   <td>Название<br></br>типа блока</td>
   <td>Описание типа</td>
   <td>Поля для редактирования / Дополнительная информация</td>
  </tr>
  <tr>
   <td><b>Раздел</b></td>
   <td>Блок с заголовком и описанием раздела отчёта.</td>
   <td>1. <b>Имя</b> - заголовок раздела (обязательно для заполнения). Если в отчёте несколько разделов, то они
   будут автоматически пронумерованы.<br></br>2. <b>Описание</b> раздела (будет написано под заголовком раздела).</td>
  </tr>
  <tr>
   <td><b>Информация<br></br>о пациенте</b></td>
   <td>Блок с информацией о пациенте, в которого был загружен образец или который
   был определен для образца (для запусков).</td>
   <td>Отображаемые поля - поля с информацией о пациенте. Нужно выбрать
   (отметить галочкой) те поля, которые будут отображаться в отчёте:<br></br>1. <b>Код пациента</b> (Patient
   ID);<br></br>2. <b>Имя</b> (First name);<br></br>3. <b>Фамилия</b> (Last name);<br></br>4. <b>
   Отчество</b> (Middle name);<br></br>5. <b>Дата рождения</b> (Date of birth);<br></br>6. <b>Возраст
   </b> (Age);<br></br>7. <b>Пол</b> (Sex);<br></br>8. <b>Поставленный диагноз</b> (Diagnosis);<br></br>9. <b>Дата
   постановки диагноза</b> (Date of diagnosis);<br></br>10. <b>Комментарии</b> (Comments).<br></br>После того,
   как вы выбрали все нужные поля, кликните вне области заполнения значения.<br></br>
   Пример блока в отчёте можно найти <a href="/results/glioma-report#patient-info">здесь</a>.</td>
  </tr>
  <tr>
   <td><b>Информация<br></br>об образце</b></td>
   <td>Блок с информацией об образце, для которого строится отчёт.</td>
   <td>Отображаемые поля - поля с информацией об образце. Нужно выбрать
   (отметить галочкой) те поля, которые будут отображаться в отчёте:<br></br>1. <b>Имя образца</b> (Sample
   name) - название файла образца без расширения;<br></br>2. <b>Дата забора крови</b> (Sample collection
   date);<br></br>3. <b>Комментарии</b> (Comments).<br></br>После
   того, как вы выбрали все нужные поля, кликните вне области заполнения значения.<br></br>
   Пример блока в отчёте можно найти <a href="/results/glioma-report#tumor-sample-info">здесь</a>.</td>
  </tr>
  <tr>
   <td><b>Форматированный текст</b></td>
   <td>Блок с любым текстом в формате <a href="https://www.markdownguide.org/basic-syntax/">Markdown</a>.</td>
   <td>В текст можно вставить определенные автополя, их описание
   приведено <a href="/settings/report-templates/report-templates#autofields">ниже</a>.</td>
  </tr>
  <tr>
   <td><b>Дисклеймер</b></td>
   <td>Блок с сообщением об ограничении использования отчёта.</td>
   <td><b>Текст</b> - стандратный текст заявления об отказе от клинической ответственности.
   Текст можно отредактировать. В текст можно вставить определенные автополя, их описание
   приведено <a href="/settings/report-templates/report-templates#autofields">ниже</a>.</td>
  </tr>
  <tr>
   <td><b>Место для подписи</b></td>
   <td>Блок с местом для подписи врача.</td>
   <td>Место для подписи в отчёте будет выглядеть так:<br></br>
   <br></br><p align="center">
   <img src={require('/img/report_templates/signing_place.png').default} width="500"/></p></td>
  </tr>
</table>

#### Автополя в блоках "Форматированный текст" и "Дисклеймер" {#autofields}

Автополе - это определенный маркер в фигурных скобках, который, если вставить его в текст блока шаблона,
будет автоматически заполняться определенным значением в готовом отчёте. Например, если вставить в текст блока
шаблона `{url}`, то в тексте отчёта на месте этого автополя появится URL-адрес текущей страницы (по сути это будет
ссылка на страницу образца). Значения в уже готовом отчёте будут меняться по мере изменения соответствующих данных о
пациенте или образце, для их обновления перезапускать генерацию отчёта не нужно.

***Список возможных автополей и их значений:***

- `{url}` - адрес текущей страницы;
- `{ReportName}` - имя отчёта (задается на странице шаблона отчёта);
- `{patient.code}` - код пациента (задается при создании пациента, может быть изменен на странице пациента);
- `{patient.firstName}` - имя пациента (задается при создании пациента или на странице пациента);
- `{patient.middleName}` - отчество пациента (задается на странице пациента);
- `{patient.lastName}` - фамилия пациента (задается при создании пациента или на странице пациента);
- `{patient.dateOfBirth}` - дата рождения пациента (задается на странице пациента);
- `{patient.age}` - возраст пациента (определяется на странице пациента);
- `{patient.sex}` - пол пациента (задается на странице пациента);
- `{patient.diagnosis}` - поставленный пациенту диагноз (задается на странице пациента);
- `{patient.dateOfDiagnosis}` - дата постановки диагноза пациента (задается на странице пациента);
- `{patient.comments}` - комментарии к карточке пациента (добавляются на странице пациента);
- `{sample.sampleName}` - название образца (имя файла без расширения; может быть изменено на странице образца);
- `{sample.sampleCollectionDate}` - дата забора крови (задается на странице образца);
- `{sample.comments}` - комментарии к образцу (добавляются на странице образца).

:::tip СОВЕТ
По правилам Markdown для перехода на новую строку в тексте используйте два пробела.
:::

### Добавленный блок шаблона {#added-template}

Добавленный блок шаблона выглядит следующим образом (пример - блок "Информация об образце"):

<p align="center">
<img src={require('/img/report_templates/block_example.png').default} width="900"/>
</p>

Сверху написано название блока, а в основной части приведена информация о его содержании.

#### Перемещение блока в шаблоне {#move-block}

Для того чтобы поднять добавленный блок выше в шаблоне (выше предыдущего блока)
нажмите на <img src={require('/img/report_templates/up.png').default} width="25"/>, а чтобы опустить ниже -
нажмите на <img src={require('/img/report_templates/down.png').default} width="25"/>.

#### Редактирование блока шаблона {#edit-block}

Для того чтобы отредактировать добавленный блок
нажмите на <img src={require('/img/report_templates/edit.png').default} width="23"/>, отредактируйте, а затем
нажмите <img src={require('/img/report_templates/add_btn.png').default} width="170"/> для сохранения изменений.
Для отмены внесенных изменений нажмите <img src={require('/img/report_templates/cancel.png').default} width="150"/>.

#### Удаление блока шаблона {#delete-block}

Для того чтобы удалить добавленный блок
нажмите на <img src={require('/img/report_templates/delete.png').default} width="23"/>, а затем
на <img src={require('/img/rus/delete.png').default} width="150"/> в появившемся окне подтверждения.
Для отмены удаления нажмите <img src={require('/img/report_templates/cancel.png').default} width="150"/>
или вне окна подтверждения.

## Экспорт шаблона отчёта {#export-template}

Опция эспорта доступна на странице шаблона, если в сохранённый шаблон был добавлен хотя бы один блок.
Чтобы экспортировать шаблон отчёта в формате JSON,
нажмите на <img src={require('/img/report_templates/export.png').default} width="160"/>.

## Импорт шаблона отчёта {#import-template}

Чтобы импортировать шаблон отчёта в систему,
нажмите на <img src={require('/img/rus/template_import.png').default} width="200"/> на странице "Шаблоны отчётов".
Перетащите файл шаблона в формате JSON в открывшееся окно или нажмите на окно, чтобы открыть диспетчер файлов.
После загрузки нажмите на <img src={require('/img/report_templates/import_btn.png').default} width="170"/>.

## Удаление шаблона отчёта {#delete-template}

Чтобы удалить шаблон отчёта, наведите курсор на строку этого шаблона на странице "Шаблоны отчётов"
и нажмите на появившуюся корзину <img src={require('/img/rus/delete_btn.png').default} width="20"/>, а затем
на <img src={require('/img/rus/delete.png').default} width="150"/> в появившемся окне подтверждения.
Для отмены удаления нажмите <img src={require('/img/report_templates/cancel.png').default} width="150"/>
или вне окна подтверждения.

## О построении отчёта {#report-generation}

Отчёт строится для образца, если выполняются следующие условия:
1. Анализ образца успешно завершился (то есть все стадии анализа имеют статус "*Завершено*").
2. Для образца были получены необходимые для построения отчёта результаты. Если шаблон включает блок "НИПТ",
то для построения соответствующего отчёта необходимо успешное завершение стадии "Выявление вариации числа копий".
4. Шаблон отчёта активен.
5. Шаблон отчёта имеет хотя бы один добавленный блок.
6. Шаблон отчёта был добавлен раньше, чем был обработан образец.

Отчёт делится на разделы и блоки. Если вы не добавили ни одного блока "Раздел" в шаблон, то все блоки будут
автоматически пронумерованы соответственно расположению в шаблоне (1, 2, 3, ...). Добавленные в шаблон разделы
также нумеруются соответственно своему расположению в шаблоне (1, 2, 3, ...). Входящие в раздел блоки нумеруются
соответственно расположению в шаблоне и в зависимости от номера раздела (1.1, 1.2, 1.3, ...). Если блок не был
включен в итоговый отчёт, то он не учитывается в нумерации.
